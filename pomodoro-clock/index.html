<html>
  <head>
    <meta charset="UTF-8" />
    <title>Pomodoro Clock</title>
    <!-- REACT -->
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
    <style>
      body {
        padding-top: 80px;
        font-family: 'Roboto Mono', monospace;
      }

    </style>
  </head>

  <body>
    <!-- HTML -->
    <div id="root"></div>

    <!-- REACT -->
    <script type="text/babel">

    let min = 0;
    let sec = 0;
    let counter = 0;
    let interval;
    let minutes = 0;
    let timeleft = 0;
    let seconds = 0;

    class App extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          type: "Session",
          minutes: "01",
          seconds: "00",
          status: "pause",
          breakMins: "01",
          breakSec: "05",
          displayMins: "01",
          displaySec: "00",
          test: true
        };
      }

      playAndPauseHandler = () => {
        // start countdown if status = "pause" and change status to "play"
        if (this.state.status == "pause") {
          this.setState({status: "play"});

          minutes = this.state.minutes;
          seconds = this.state.seconds;
          timeleft = (parseInt(minutes, 10) * 60) + (parseInt(seconds, 10));
          interval = setInterval(() => countDownSecs(), 100);

          let convertTotalSeconds = (s) => {
            min = Math.floor(s / 60);
            sec = s%60;
            if (sec < 10) {
              sec = "0"+sec;
            }
            if (min < 10) {
              min = "0"+min;
            }
            this.setState({
              displayMins: min,
              displaySec: sec
            });
            console.log(min + ":" + sec);
          }

          let countDownSecs = () => {
            counter++;
            convertTotalSeconds(timeleft-counter);

            if (counter == timeleft) {
              clearInterval(interval);
              counter = 0;
              console.log("back to break");
              this.setState({type: "Break"});
              minutes = this.state.breakMins;
              seconds = this.state.breakSec;
              console.log("break ", minutes + seconds);
              timeleft = (parseInt(minutes, 10) * 60) + (parseInt(seconds, 10));
              interval = setInterval(() => breakCountDown(), 200);
            }
          }

          let breakCountDown = () => {
            counter++;
            convertTotalSeconds(timeleft-counter);
            if (counter == timeleft) {
              console.log("back to session");
              clearInterval(interval);
              counter = 0;
              this.setState({type: "Session"});
              minutes = this.state.minutes;
              console.log(minutes);
              seconds = this.state.seconds;
              timeleft = (parseInt(minutes, 10) * 60) + (parseInt(seconds, 10));
              console.log("session ", minutes + seconds);
              interval = setInterval(() => countDownSecs(), 200);
            }
          }
        } else {
          // pause the countdown and change status to "pause"
          if (this.state.status =="play") {
            this.setState({status: "pause"})
            console.log('stop' + min + ":" + sec);
            clearInterval(interval);
            counter = 0;
          }
        }
      }

      resetHandler = () => {
        this.setState({
          minutes: "25",
          seconds: "00",
          status: "pause",
          break: "5"
        })
      }

      render() {
        return (
          <div>
            <div>
              <h2 id="break-label">Break Length</h2>
              <p id="break-length">{this.state.breakMins}</p>
            </div>
            <div>
              <h2 id="session-label">Session Length</h2>
              <p id="session-length">{this.state.minutes}</p>
            </div>

            <div>
              <button id="break-decrement"></button>
              <button id="session-decrement"></button>
              <button id="break-increment"></button>
              <button id="session-increment"></button>
            </div>

            <div>
              <h2 id="timer-label">{this.state.type}</h2>
              <p id="time-left">{this.state.displayMins}:{this.state.displaySec}</p>
              <button id="start_stop" onClick={this.playAndPauseHandler}>Play/Pause</button>
              <button id="reset" onClick={this.resetHandler}>Reset</button>
            </div>


            {this.state.status}
          </div>
        );
      }
    }


    ReactDOM.render(<App />, document.getElementById('root'));

    </script>

    <!-- FCC tests -->
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
  </body>
</html>
